<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Jewel Design Tool</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;

      justify-content: center;
      padding: 20px;
    }
    .bead-library,
    .design-area {
      border: 1px solid #ccc;
      padding: 20px;
      width: 40%;
    }
.design-area.light {
  background-image: url('crystaltray-light.PNG');
  background-size: 420px 420px;
  background-position: 8px 24px;
}
#price-toggle-handle:hover {
  background: #666;
}
.design-area.dark {
  background-image: url('woodtray-dark.png');
  background-size: 430px 430px;
  background-position: 8px 20px;
}
#tray-bg {
  transition: opacity 0.5s ease;
}
    #center-thread {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 300px;
      height: 300px;
      border: 2px solid lightgray;
      border-radius: 50%;
      transform: translate(-50%, -50%);
      pointer-events: none;
      z-index: 5;
    }
    .bead {
      display: inline-block;
      cursor: grab;
      position: relative;
    }

    .bead.small.round { width: 30px; height: 30px; border-radius: 50%; }
    .bead.large.round { width: 50px; height: 50px; border-radius: 50%; }


.design-area {
  position: relative;
  width: 400px;
  height: 400px;

  background-size: 450px 450px;
  background-position: 8px 24px;
  border-radius: 10px;
  margin-left: 20px;
  overflow: hidden;
}


    .bead-in-design {
      position: absolute;
      transform: translate(-50%, -50%);
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="bead-library" style="background-color: #e0e0e5; padding: 15px; border-radius: 10px;">
    <button onclick="clearDesignArea()" style="margin-bottom: 10px;">Clean</button>
    <button onclick="toggleBackground()" style="margin-bottom: 10px;">Toggle Background</button>
    <div style="margin-top: 10px;">
      <input type="number" id="bead-count" value="18" min="1" max="50" />
      <button onclick="updateBeadCount()">Set Bead Count & Start</button>
    </div>
    <h3>Bead Library</h3>
    <div id="library"></div>

    <div style="margin-top: 10px; padding: 10px; border-top: 1px solid #ccc;">
      <p>Please use a larger screen for the best experience.</p>
    </div>


  </div>
<div id="price-panel-wrapper" style="position: fixed; top: 20px; right: 0; height: 60vh; z-index: 20; display: flex; align-items: flex-start; transition: transform 0.3s ease;">
  <!-- handle -->
  <div id="price-toggle-handle" onclick="togglePricePanel()" style="
    width: 10px;
    height: 4%;
    background: #888;
    cursor: pointer;
    border-radius: 4px 0 0 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;

  ">
    <span id="price-arrow">&lt;</span>
  </div>

  <!-- price panel -->
  <div id="price-display" style="
    background: #fff;
    padding: 10px;
    border: 1px solid #ccc;
    font-family: monospace;
    max-height: 100%;
    overflow-y: auto;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  "></div>
</div>


<audio id="drop-sound" src="bead-drop.mp3" preload="auto"></audio>
<div id="music-wrapper" onclick="toggleMusic()" style="
  position: fixed;
  right: 16px;
  bottom: 16px;
  max-width: 80px;
  cursor: pointer;
  z-index: 10;
  text-align: center;
">
  <img id="music-static" src="music-static-good.png" style="width: 80px; transition: opacity 0.6s;" />
  <img id="music-gif" src="music.gif" style="width: 80px; position: absolute; top: 0; left: 0; opacity: 0; transition: opacity 0.6s;" />
  <div style="
    margin-top: 4px;
    font-size: 11px;
    color: #444;
    background: rgba(255, 255, 255, 0.7);
    padding: 2px 4px;
    border-radius: 4px;
    pointer-events: none;
  ">Music?<br/>Click me.</div>
</div>

<audio id="background-audio" src="intheforest.mp3" loop></audio>


  <div class="design-area light" id="design-area" ondragover="event.preventDefault()" ondrop="drop(event)">
    <!--<div id="center-thread"></div>-->
  </div>

  <script>
    const colors = [];
    let library = document.getElementById("library");
let totalPrice = 0.0;
let beadCart = {};
    let beadPositions = [];
let isPlaying = false;
 let isPriceVisible = true;

function togglePricePanel() {
  const wrapper = document.getElementById("price-panel-wrapper");
  const arrow = document.getElementById("price-arrow");
  isPriceVisible = !isPriceVisible;

  if (isPriceVisible) {
    wrapper.style.transform = "translateX(0)";
    arrow.textContent = "<";
  } else {
    wrapper.style.transform = "translateX(85%)";
    arrow.textContent = ">";
  }
}


function toggleMusic() {
  const audio = document.getElementById("background-audio");
  const staticImg = document.getElementById("music-static");
  const gifImg = document.getElementById("music-gif");

  if (!isPlaying) {
    audio.play();
    staticImg.style.opacity = 0;
    gifImg.style.opacity = 1;
    isPlaying = true;
  } else {
    audio.pause();
    staticImg.style.opacity = 1;
    gifImg.style.opacity = 0;
    isPlaying = false;
  }
}
    function updateBeadCount() {
      beadCount = parseInt(document.getElementById("bead-count").value, 10);
      beadPositions = Array(beadCount).fill(null);
 clearDesignArea()
    }

    function getEmptyPosition() {
      return beadPositions.indexOf(null);
    }
function getFilledBeadCount() {
  return beadPositions.filter(pos => pos !== null).length;
}
    function createBead(color, size, shape = "round") {
      let bead = document.createElement("div");
      bead.className = `bead ${size} ${shape}`;
      bead.style.backgroundColor = color;
      bead.draggable = true;
      bead.setAttribute("data-color", color);
      bead.setAttribute("data-size", size);
      bead.setAttribute("data-shape", shape);
      bead.onclick = () => addBead(color, size, shape);
      bead.ondragstart = (event) => {
        event.dataTransfer.setData("color", color);
        event.dataTransfer.setData("size", size);
        event.dataTransfer.setData("shape", shape);
      };
      library.appendChild(bead);
    }
function updatePriceDisplay() {
  let displayHTML = "";
  for (let key in beadCart) {
    const { count, price } = beadCart[key];


    const name = key.split("/").pop().split(".")[0];


    displayHTML += `
      <div style="display: flex; align-items: center; margin-bottom: 5px;">
        <img src="${key}" alt="${name}" style="width: 30px; height: 30px; object-fit: cover; margin-right: 10px;" />
        ${count} Ã— $${price.toFixed(2)} = $${(count * price).toFixed(2)}
      </div>
    `;
  }
  displayHTML += `<strong>Total: $${totalPrice.toFixed(2)}</strong>`;
  document.getElementById("price-display").innerHTML = displayHTML;
}

    function createImageBead(imageURL, size, shape = "round", price = 5.0) {
      let bead = document.createElement("div");
      bead.className = `bead ${size} ${shape}`;
      bead.style.backgroundImage = `url('${imageURL}')`;
      bead.style.backgroundSize = "cover";
      bead.style.backgroundPosition = "center";
      bead.draggable = true;
      bead.onclick = () => addImageBead(imageURL, size, shape, price);
      bead.ondragstart = (event) => {
        event.dataTransfer.setData("image", imageURL);
        event.dataTransfer.setData("size", size);
        event.dataTransfer.setData("shape", shape);
	event.dataTransfer.setData("price", price);
      };
      library.appendChild(bead);
    }

    colors.forEach((color) => {
      createBead(color, "small", "round");
      createBead(color, "large", "round");
    });

    createImageBead("tigereye.png", "large", "round", 3.1);
    createImageBead("neptune.png", "large", "round", 3.2);
    createImageBead("earth.png", "large", "round", 3.5);
    createImageBead("uranus.png", "large", "round", 3.5);
    createImageBead("saturn.png", "large", "round", 3.5);
    createImageBead("venus.png", "large", "round", 3.5);
    createImageBead("mars.png", "large", "round", 3.5);
    createImageBead("pink.png", "large", "round", 3.0);
    createImageBead("whitejade.png", "large", "round", 3.0);
    createImageBead("moonstone.png", "large", "round", 5.2);
    createImageBead("amethyst.png", "large", "round", 5.2);
    createImageBead("orange-agate.png", "large", "round", 5.8);
    createImageBead("red-agate.png", "large", "round", 5.8);
    createImageBead("white-agate.png", "large", "round", 3.8);
    createImageBead("red-c-agate.png", "large", "round", 3.8);
    createImageBead("pearl-large.png", "large", "round", 3.8);
    createImageBead("howlite.png", "large", "round", 1.0);
    createImageBead("lava-stone.png", "large", "round", 5.8);
    createImageBead("green-rutilated-quartz.png", "large", "round", 8.8);
    createImageBead("goldenobsidian.png", "large", "round", 10.2);
    createImageBead("bodhi.png", "large", "round", 5.2);
    createImageBead("silver-ball.png", "large", "round", 20.2);
    createImageBead("silver-filigree-bead.png", "large", "round", 9.2);
    createImageBead("silvercircle-tocentre.png", "large", "round", 5.2);
    createImageBead("maple-pendant--tocentre.png", "large", "round", 8.0);
    createImageBead("goldwhitebead-tocentre.png", "large", "round", 8.0);
    createImageBead("goldcircle-tocentre.png", "large", "round", 8.0);
    createImageBead("red-heart-pendant-tocentre.png", "large", "round", 10.2);

    function addBead(color, size, shape) {
  if (getFilledBeadCount() >= beadCount) {
    alert("Maximum number of beads reached.");
    return;
  }
      addToDesignArea({ backgroundColor: color }, size, shape);
    }

function addImageBead(imageURL, size, shape, price = 5.0) {
  if (getFilledBeadCount() >= beadCount) {
    alert("Maximum number of beads reached.");
    return;
  }

  if (!beadCart[imageURL]) {
    beadCart[imageURL] = { count: 1, price: price };
  } else {
    beadCart[imageURL].count += 1;
  }


  totalPrice += price;


  updatePriceDisplay();
  addToDesignArea(
    {
      backgroundImage: `url('${imageURL}')`,
      backgroundSize: "cover",
      backgroundPosition: "center"
    },
    size,
    shape,
    imageURL
  );
}


    function addToDesignArea(styleObj, size, shape, imageURL = "") {
      let designArea = document.getElementById("design-area");
      let centerX = designArea.clientWidth / 2;
      let centerY = designArea.clientHeight / 2;
      let radius = 114;
      let beadWidth = size === "small" ? 30 : 50;
      let beadHeight = beadWidth;

      let index = getEmptyPosition();
      if (index === -1) return;
      let angle = (index / beadCount) * 2 * Math.PI;
let effectiveRadius = radius;
if (imageURL && imageURL.includes("pendant")) {
  effectiveRadius += 20;
}

let x = centerX + effectiveRadius * Math.cos(angle);
let y = centerY + effectiveRadius * Math.sin(angle);

      let bead = document.createElement("div");
      bead.className = `bead bead-in-design ${size} ${shape}`;
      Object.assign(bead.style, styleObj);
      bead.style.width = beadWidth + "px";
      bead.style.height = beadHeight + "px";
      bead.style.left = x + "px";
      bead.style.top = y + "px";
      bead.style.position = "absolute";
      bead.style.borderRadius = shape === "square" ? "0" : "50%";
      //bead.style.transform = "translate(-50%, -50%)";
// Compute angle from bead to center
const dx = centerX - x;
const dy = centerY - y;
const rotationAngle = Math.atan2(dy, dx) * (180 / Math.PI);

// Only apply rotation to specific elongated beads
if (imageURL.includes("tocentre")){
  bead.style.transform = `translate(-50%, -50%) rotate(${rotationAngle}deg)`;
} else {
  bead.style.transform = "translate(-50%, -50%)";
}

      bead.dataset.index = index;
      bead.draggable = true;

      bead.ondragend = (event) => {
        let threadRect = document.getElementById("center-thread").getBoundingClientRect();
        let beadRect = bead.getBoundingClientRect();
        let dx = beadRect.left + beadRect.width / 2 - (threadRect.left + threadRect.width / 2);
        let dy = beadRect.top + beadRect.height / 2 - (threadRect.top + threadRect.height / 2);
        if (Math.sqrt(dx * dx + dy * dy) < 30) {
          bead.remove();
          beadPositions[bead.dataset.index] = null;
        }
      };

const dropSound = document.getElementById("drop-sound");
dropSound.currentTime = 0;
dropSound.play();

      bead.ondblclick = () => {
        bead.remove();
        beadPositions[index] = null;

  let identifier = bead.style.backgroundImage || bead.style.backgroundColor;
  if (identifier.includes('url("')) {
    identifier = identifier.slice(5, -2);
  }


  if (beadCart[identifier]) {
    beadCart[identifier].count -= 1;
    totalPrice -= beadCart[identifier].price;

    if (beadCart[identifier].count <= 0) {
      delete beadCart[identifier];
    }

    updatePriceDisplay();
  }
      };

      designArea.appendChild(bead);
      beadPositions[index] = bead;
    }

    function drop(event) {
      event.preventDefault();
      let color = event.dataTransfer.getData("color");
      let image = event.dataTransfer.getData("image");
      let size = event.dataTransfer.getData("size");
      let shape = event.dataTransfer.getData("shape");
      if (image) addImageBead(image, size, shape);
      else if (color) addBead(color, size, shape);
    }

function clearDesignArea() {
  const designArea = document.getElementById("design-area");


  while (designArea.firstChild) {
    designArea.removeChild(designArea.firstChild);
  }


  beadPositions = Array(beadCount).fill(null);
  beadCart = {};
  totalPrice = 0;

  updatePriceDisplay();
}


    function toggleBackground() {
      let designArea = document.getElementById("design-area");
      designArea.classList.toggle("dark");
      designArea.classList.toggle("light");
    }
  </script>
</body>
</html>
