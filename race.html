<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Racing Game</title>
<style>
    body {
        margin: 0;
        padding: 0;
        overflow: hidden;
    }
    .tree {
        width: 70px;
        height: 50px;
        background-color: green;
        position: absolute;
        top: 0;
        animation: treeSwing 3s ease-in-out infinite alternate; /* 树木摇摆动画 */
    }
    @keyframes treeSwing {
        0% { transform: rotateZ(-5deg); }
        100% { transform: rotateZ(5deg); }
    }
    .left-tree {
        left: 10px;
    }
    .right-tree {
        right: 10px;
    }
    #road {
        width: 600px;
        height: 100vh;
        background-color: #000;
        position: relative;
        margin: 0 auto;
    }
    #car {
        width: 35px;
        height: 100px;
        position: absolute;
        bottom: 0;
        left: 50%;
        transform: translateX(-50%);
    }
    .obstacle {
        width: 41px;
        height: 50px;
        position: absolute;
        top: -50px;
    }
    .diamond {
        width: 30px;
        height: 30px;
        position: absolute;
    }
    .traffic-line {
        width: 4px;
        height: 1000px;
        background-color: white;
        position: absolute;
        left: 50%;
        top: 0;
        transform: translateX(-50%);
    }
    #diamondCounter {
        position: absolute;
        top: 10px;
        left: 10px;
        color: white;
        font-size: 18px;
    }
</style>
</head>
<body>
<div id="road">
    <div class="tree left-tree"></div>
    <div class="tree right-tree"></div>
    <img id="car" src="player.png" alt="Player">
    <div class="traffic-line"></div>
    <div id="diamondCounter">Diamonds: 0</div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function () {
    const car = document.getElementById('car');
    let obstacles = [];
    let diamonds = [];
    let obstacleInterval;
    let diamondInterval;
    let gameover = false;
    let diamondCount = 0;
    let trees = [];

    function moveCar(direction) {
        const leftPosition = parseFloat(window.getComputedStyle(car).getPropertyValue('left'));
        const topPosition = parseFloat(window.getComputedStyle(car).getPropertyValue('top'));
        const roadWidth = parseFloat(window.getComputedStyle(document.getElementById('road')).width);
        const carWidth = parseFloat(window.getComputedStyle(car).width);
        const roadHeight = parseFloat(window.getComputedStyle(document.getElementById('road')).height);
        const carHeight = parseFloat(window.getComputedStyle(car).height);

        if (direction === 'left' && leftPosition > 0) {
            car.style.left = leftPosition - 7 + 'px';
        } else if (direction === 'right' && leftPosition < roadWidth - carWidth) {
            car.style.left = leftPosition + 7 + 'px';
        }else if (direction === 'up' && topPosition > 0) {
            car.style.top = topPosition - 5 + 'px';
        } else if (direction === 'down' && topPosition < roadHeight - carHeight) {
            car.style.top = topPosition + 5 + 'px';
        }
    }

    function createObstacle() {
        const obstacle = document.createElement('div');
        obstacle.classList.add('obstacle');
        const road = document.getElementById('road');
        const roadWidth = parseFloat(window.getComputedStyle(road).width);
        const randomPosition = Math.floor(Math.random() * (roadWidth - 50));
        obstacle.style.left = randomPosition + 'px';
        obstacle.innerHTML = '<img src="enemy.png" alt="Enemy">';
        road.appendChild(obstacle);
        obstacles.push(obstacle);
    }

    function createTrees() {
        const roadHeight = parseFloat(window.getComputedStyle(document.getElementById('road')).height);
        const treeSpacing = roadHeight / 10;
        for (let i = 1; i <= 9; i++) {
            const leftTreeLeft = -90 + Math.random() * 20; // Randomize the left tree's left position slightly
            const rightTreeLeft = 610 + Math.random() * 20; // Randomize the right tree's left position slightly
            const leftTree = document.createElement('div');
            const rightTree = document.createElement('div');
            leftTree.classList.add('tree', 'left-tree');
            rightTree.classList.add('tree', 'right-tree');
            leftTree.style.top = (i * treeSpacing) + 'px';
            rightTree.style.top = (i * treeSpacing) + 'px';
            leftTree.style.left = leftTreeLeft + 'px';
            rightTree.style.left = rightTreeLeft + 'px';
            document.getElementById('road').appendChild(leftTree);
            document.getElementById('road').appendChild(rightTree);
            trees.push(leftTree, rightTree);
        }
    }

    function createDiamond() {
        const diamond = document.createElement('div');
        diamond.classList.add('diamond');
        const road = document.getElementById('road');
        const roadWidth = parseFloat(window.getComputedStyle(road).width);
        const randomPosition = Math.floor(Math.random() * (roadWidth - 30));
        diamond.style.left = randomPosition + 'px';
        diamond.innerHTML = '<img src="diamond.png" alt="Diamond">';
        road.appendChild(diamond);
        diamonds.push(diamond);
    }

    function moveObstacles() {
        obstacles.forEach(function (obstacle) {
            if (!gameover) {
                const topPosition = parseFloat(window.getComputedStyle(obstacle).getPropertyValue('top'));
                obstacle.style.top = topPosition + 2 + 'px';

                if (topPosition > window.innerHeight) {
                    obstacle.remove();
                    obstacles.shift();
                }

                const carLeft = parseFloat(window.getComputedStyle(car).getPropertyValue('left'));
                const carTop = parseFloat(window.getComputedStyle(car).getPropertyValue('top'));
                const obstacleLeft = parseFloat(window.getComputedStyle(obstacle).getPropertyValue('left'));
                const obstacleTop = parseFloat(window.getComputedStyle(obstacle).getPropertyValue('top'));
                const obstacleWidth = parseFloat(window.getComputedStyle(obstacle).width);

                if (carLeft < obstacleLeft + obstacleWidth &&
                    carLeft + parseFloat(window.getComputedStyle(car).width) > obstacleLeft &&
                    carTop < obstacleTop + parseFloat(window.getComputedStyle(obstacle).height) &&
                    carTop + parseFloat(window.getComputedStyle(car).height) > obstacleTop) {
                    gameover = true;
                    clearInterval(obstacleInterval);
                    clearInterval(diamondInterval);
                    setTimeout(function () {
                        gameover = false;
                        startGame();
                    }, 2000);
                }
            }
        });
    }

    function moveDiamonds() {
        diamonds.forEach(function (diamond) {
            const topPosition = parseFloat(window.getComputedStyle(diamond).getPropertyValue('top'));
            diamond.style.top = topPosition + 2 + 'px';

            if (topPosition > window.innerHeight) {
                diamond.remove();
                diamonds.shift();
            }

            const carLeft = parseFloat(window.getComputedStyle(car).getPropertyValue('left'));
            const carTop = parseFloat(window.getComputedStyle(car).getPropertyValue('top'));
            const diamondLeft = parseFloat(window.getComputedStyle(diamond).getPropertyValue('left'));
            const diamondTop = parseFloat(window.getComputedStyle(diamond).getPropertyValue('top'));
            const diamondWidth = parseFloat(window.getComputedStyle(diamond).width);

            if (carLeft < diamondLeft + diamondWidth &&
                carLeft + parseFloat(window.getComputedStyle(car).width) > diamondLeft &&
                carTop < diamondTop + parseFloat(window.getComputedStyle(diamond).height) &&
                carTop + parseFloat(window.getComputedStyle(car).height) > diamondTop) {
                diamond.remove();
                diamonds.shift();
                diamondCount++;
                document.getElementById('diamondCounter').innerText = 'Diamonds: ' + diamondCount;
            }
        });
    }

    function startGame() {
        if (!gameover) {
            obstacleInterval = setInterval(createObstacle, 1000);
            diamondInterval = setInterval(createDiamond, 3000);
            createTrees()
            document.addEventListener('keydown', function (e) {
                if (e.key === 'a' || e.key === 'ArrowLeft') {
                    moveCar('left');
                } else if (e.key === 'd' || e.key === 'ArrowRight') {
                    moveCar('right');
                } else if (e.key === 'w' || e.key === 'ArrowUp') {
                    moveCar('up');
                } else if (e.key === 's' || e.key === 'ArrowDown') {
                    moveCar('down');
}
            });
            setInterval(moveObstacles, 10);
            setInterval(moveDiamonds, 10);
        }
    }

    startGame();
});
</script>
</body>
</html>
